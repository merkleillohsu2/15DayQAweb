<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»»å‹™ç¸½è¡¨</title>
    <link rel="stylesheet" href="/stylesheets/style.css">
    <link rel="stylesheet" href="/stylesheets/task-list.css">
    <script src="/scripts/common.js" ></script>
</head>
<body>
    <header>
        <!-- çå‹µåœ–ç‰‡å€åŸŸ -->
        <div class="reward-banner">
            <% 
                    // è¨ˆç®—çå‹µç™¾åˆ†æ¯”ï¼ˆå·²è™•ç†ç‰¹å®šç¯„åœï¼‰
                    let rewardLevel = 0;
                    
                    if (user.rewards >= 75 && user.rewards <= 99) {
                        rewardLevel = 75; // 75 åˆ° 99 å°æ‡‰çå‹µ 75
                    } else if (user.rewards >= 100) {
                        rewardLevel = 100; // 100 ä»¥ä¸Šå°æ‡‰çå‹µ 100
                    } else {
                        const rounded = Math.ceil(user.rewards / 5) * 5;
                        rewardLevel = (rounded <= 5) ? 5 : rounded;
                    }
                    
                    // è¨­å®šåœ–ç‰‡åç¨±
                    const rewardImage = `pig-$${rewardLevel}.gif`;
            %>
            
            <!-- é¡¯ç¤ºå°æ‡‰çš„çå‹µåœ–ç‰‡ -->
            <div class="reward-container">
                <img src="/images/Reward/<%= rewardImage %>" alt="çå‹µåœ–ç‰‡" class="reward-image">
                <span class="reward-amount">
                    <img src="/images/Reward/coin_03.png" alt="é‡‘å¹£åœ–ç¤º" class="coin-icon">
                    <%= typeof user.rewards !== 'undefined' && user.rewards !== null ? user.rewards : 0 %> å…ƒ
                </span>
            </div>
            
        </div>
    </header>
    <main>
        <!-- ä»»å‹™æŒ‰éˆ•å€åŸŸ -->
        <div class="task-list">
            <% 
                tasks.sort((a, b) => a.TaskID - b.TaskID);
                const maxTaskId = Math.max(...tasks.map(t => t.TaskID));
                tasks.forEach((task) => {
                const isLocked = task.status === 'æœªé–‹å§‹';
                const taskImage = task.IsCompleted || task.status === 'å·²çµæŸ'
                    ? `/images/Task-list/pasttask/CTA-past task_M${task.TaskID}.png`
                    : task.status === 'é€²è¡Œä¸­'
                    ? `/images/Task-list/todaytask/CTA-today task_M${task.TaskID}.png`
                    : `/images/Task-list/futuretask/CTA-future task_M${task.TaskID}.png`;
            %>

                <button 
                    class="task-button <%= isLocked ? 'locked' : '' %>" 
                    <%= isLocked ? 'disabled' : '' %> 
                    onclick="<%= isLocked ? '' : `redirectToTask('${task.TaskID}')` %>"
                >
                    <img src="<%= taskImage %>" alt="ä»»å‹™åœ–ç‰‡">
                     <% if (task.ShowDrawReminder) { %>
                        <div class="draw-reminder">
                            åŠ ç¢¼æŠ½æœªå®Œæˆ
                        </div>
                        <% } %>
                </button>
            <% }); %>
        </div>
        <img src="/images/æ¯æ—¥ä»»å‹™_bg_Footer.jpg" alt="èƒŒæ™¯è£é£¾" style="max-width: 100%; margin: 35px auto 0; display: block;width: 100%;" />
           <img
    src="/images/backgroundscorllcolor.jpg"
    alt="èƒŒæ™¯è£é£¾"
    style="max-width: 100%; margin: 35px auto 0; display: block;width: 100%;"
  />
      <script>
          function redirectToTask(taskId) {
            navigateToParent(`task-${taskId}`)
              // ç²å–ç•¶å‰ URL çš„æŸ¥è©¢åƒæ•¸
              //const queryParams = new URLSearchParams(window.location.search);
              // ç”Ÿæˆç›®æ¨™ URLï¼Œä¿ç•™æŸ¥è©¢åƒæ•¸
              //const targetUrl = `/task/${taskId}?${queryParams.toString()}`;
              // é‡å®šå‘åˆ°æ–°é é¢
              //window.location.href = targetUrl;
          }
      </script>
      <script>
        const today = "<%= currentDate.toISOString() %>";
        console.log("ğŸ“… ä»Šæ—¥æ—¥æœŸï¼ˆå¾Œç«¯å‚³å…¥ï¼‰:", today);
      </script>
      <script>
        const tasks = <%- JSON.stringify(tasks) %>;
        tasks.forEach(task => {
            console.log(`ğŸ“ ä»»å‹™ ${task.TaskID} - ${task.TaskName} ç‹€æ…‹ï¼š${task.status}`);
        });
        </script>

      
    </main>
</body>
</html>
